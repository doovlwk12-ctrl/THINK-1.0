# رفع منصة فكرة على المنصات

دليل سريع لرفع المشروع على **GitHub** ثم نشره على **Vercel** (أو **Render**).

---

## 1. رفع الكود على GitHub

```bash
# إن لم يكن المشروع مرفوعاً بعد
git add .
git commit -m "جاهز للنشر"
git branch -M main
git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git
git push -u origin main
```

إذا كان المستودع موجوداً وتريد تحديثه فقط:

```bash
git add .
git commit -m "تحديث قبل النشر"
git push origin main
```

---

## 2. النشر على Vercel (موصى به)

1. ادخل إلى [vercel.com](https://vercel.com) وسجّل الدخول (يفضل عبر GitHub).
2. **Add New…** → **Project**.
3. اختر مستودع المشروع من GitHub (أو **Import** واربط الحساب ثم اختر المستودع).
4. **Project Name:** استخدم أحرفاً صغيرة وأرقاماً وشرطة فقط، مثال: `think-1-0` أو `fekra-platform`.
5. **Framework Preset:** Next.js (يُكتشف تلقائياً).
6. **Environment Variables** — أضف المتغيرات التالية (من **Settings → Environment Variables** أو أثناء إنشاء المشروع):

| المتغير | القيمة | مطلوب |
|---------|--------|--------|
| `DATABASE_URL` | رابط PostgreSQL (Supabase: من Connect → **Transaction**، أضف في النهاية `?pgbouncer=true`) | نعم |
| `NEXTAUTH_SECRET` | سلسلة عشوائية 32+ حرفاً، مثلاً: `openssl rand -base64 32` | نعم |
| `NEXTAUTH_URL` | رابط الموقع بعد النشر، مثال: `https://اسم-المشروع.vercel.app` | نعم |
| `USE_SUPABASE_AUTH` | `true` | عند استخدام Supabase |
| `NEXT_PUBLIC_USE_SUPABASE_AUTH` | `true` | عند استخدام Supabase |
| `NEXT_PUBLIC_SUPABASE_URL` | `https://xxxxx.supabase.co` | مع Supabase |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | المفتاح العام من Supabase → API | مع Supabase |
| `SUPABASE_SERVICE_ROLE_KEY` | مفتاح service_role من Supabase (سري) | موصى به مع Supabase |

7. اضغط **Deploy**.
8. بعد انتهاء البناء، حدّث `NEXTAUTH_URL` برابط الموقع الفعلي ثم **Redeploy**.
9. في **Supabase** → **Authentication → URL Configuration**: ضع **Site URL** = رابط Vercel، وأضف في **Redirect URLs** نفس النطاق ومسارات مثل `/reset-password`.

**تطبيق الهجرات على قاعدة الإنتاج (مرة واحدة):**

```bash
# من جهازك (مع .env يحتوي DATABASE_URL للإنتاج)
npx prisma migrate deploy
```

---

## 3. النشر على Render (بديل)

1. من [dashboard.render.com](https://dashboard.render.com): **New +** → **PostgreSQL** لإنشاء قاعدة بيانات، انسخ **Internal Database URL**.
2. **New +** → **Web Service**، اربط مستودع GitHub واختر الفرع (مثل `main`).
3. الإعدادات:
   - **Build Command:** `npm install && npx prisma generate && npm run build`
   - **Start Command:** `npx prisma migrate deploy && npm start`
4. من **Environment** أضف: `DATABASE_URL`، `NEXTAUTH_URL` (رابط الخدمة بعد النشر)، `NEXTAUTH_SECRET`، ومتغيرات Supabase إن استخدمتها.
5. **Create Web Service**.

---

## 4. التحقق بعد النشر

- افتح رابط الموقع وتأكد من تحميل الصفحة الرئيسية.
- جرّب **تسجيل الدخول** أو **إنشاء حساب**.
- تأكد من **Supabase → Authentication → URL Configuration** أن **Site URL** و **Redirect URLs** يطابقان نطاق الموقع المنشور.

للتفاصيل الكاملة (خطأ 503، Pooler، إلخ) راجع [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md) و [DEPLOYMENT.md](DEPLOYMENT.md).
