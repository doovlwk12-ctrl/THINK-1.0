# تسجيل عادي وتسجيل الدخول مع Supabase

## المطلوب (تسجيل عادي بدون تأكيد بريد)

1. **التحقق من البيانات:** الاسم، البريد، الجوال، كلمة المرور (يتم في الواجهة والـ API).
2. **التحقق من عدم التسجيل مسبقاً:** إن البريد أو الجوال غير مستخدم في القاعدة (يتم في `/api/auth/register`).
3. **بعد إنشاء الحساب:** يستطيع العميل تسجيل الدخول فوراً والتوجيه للصفحة المناسبة (لوحة التحكم حسب الدور).

## ما يفعله المشروع

- **عند التسجيل:** يتحقق الـ API من البريد والجوال في Prisma، ثم ينشئ المستخدم في Supabase وفي جدول User. إذا وُجد `SUPABASE_SERVICE_ROLE_KEY` يتم تأكيد البريد تلقائياً حتى يتمكن المستخدم من الدخول مباشرة.
- **عند تسجيل الدخول:** بعد إدخال البريد وكلمة المرور يتم التوجيه إلى `/dashboard` أو `/admin/dashboard` أو `/engineer/dashboard` حسب الدور.

## إعداد Supabase (مرة واحدة)

### 1) مفتاح Service Role (موصى به لتسجيل عادي)

من **Supabase → Project Settings → API** انسخ **service_role** (سرّي) وأضفه في Vercel وملف `.env` كـ:

```env
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

بهذا يتم تأكيد البريد تلقائياً بعد التسجيل ويمكن للعميل الدخول فوراً.

### 2) (اختياري) تعطيل تأكيد البريد من اللوحة

إذا لم تستخدم Service Role أو أردت تعطيل طلب التأكيد بالكامل:

- **Supabase Dashboard → Authentication → Providers → Email**
- أوقف **Confirm email** (أو "Enable email confirmations").

بهذا لن يطلب Supabase تأكيد البريد لأي مستخدم جديد.

## ملاحظة أمان

- لا تضع `SUPABASE_SERVICE_ROLE_KEY` في الكود الذي يعمل في المتصفح؛ استخدمه فقط في مسارات الـ API على السيرفر.
