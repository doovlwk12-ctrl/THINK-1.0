# دليل الاختبار اليدوي للمصادقة

هذا الدليل يوفّر خطوات تنفيذية للتحقق من سير عمل المصادقة والصلاحيات وفق [AUTH-WORKFLOW.md](AUTH-WORKFLOW.md). يُنفَّذ يدوياً في المتصفح مع بيئة التطوير أو بيئة تجريبية.

---

## 1. زائر غير مسجّل — الصفحة الرئيسية

| البند | التفاصيل |
|-------|----------|
| **الخطوة** | فتح الصفحة الرئيسية بدون تسجيل دخول. |
| **الرابط** | `/` |
| **المتوقّع** | عرض الصفحة الرئيسية، أزرار **تسجيل الدخول** و**إنشاء حساب** في الهيدر، وعدم ظهور قائمة المستخدم أو لوحة التحكم. |
| **حالة التنفيذ** | ☐ |

---

## 2. إنشاء حساب (التسجيل)

| البند | التفاصيل |
|-------|----------|
| **الخطوة** | فتح صفحة التسجيل وإنشاء حساب جديد (اسم، بريد، جوال، كلمة مرور). |
| **الرابط** | `/register` |
| **المتوقّع** | بعد نجاح التسجيل: **تسجيل دخول تلقائي** ثم التوجيه إلى لوحة التحكم حسب الدور (عميل جديد → `/dashboard`). لا يُوجّه إلى `/login` إلا إذا فشل تسجيل الدخول التلقائي (مثلاً خطأ شبكة). |
| **ملاحظة** | يطبّق مع NextAuth وSupabase. |
| **حالة التنفيذ** | ☐ |

---

## 3. تسجيل الدخول — التوجيه حسب الدور

| البند | التفاصيل |
|-------|----------|
| **الخطوة** | من صفحة تسجيل الدخول إدخال بريد وكلمة مرور مستخدم موجود. |
| **الرابط** | `/login` |
| **المتوقّع** | بعد النجاح: توجيه فوري حسب الدور — عميل → `/dashboard`، مهندس → `/engineer/dashboard`، أدمن → `/admin/dashboard`. عدم بقاء المستخدم في `/login` أو التوجيه الخاطئ إلى لوحة العميل للمهندس/الأدمن. |
| **حالة التنفيذ** | ☐ |

---

## 4. عميل مسجّل — منع الوصول لمسارات الأدمن

| البند | التفاصيل |
|-------|----------|
| **الخطوة** | تسجيل الدخول كـ **عميل** ثم محاولة فتح لوحة الإدارة. |
| **الرابط** | `/admin/dashboard` (أو أي مسار تحت `/admin/*`) |
| **المتوقّع** | إما توجيه إلى `/dashboard` (لوحة العميل) أو عرض محتوى يوضح عدم الصلاحية؛ عدم عرض محتوى إدارة النظام للعميل. |
| **حالة التنفيذ** | ☐ |

---

## 5. مهندس / أدمن — عدم بقاء لوحة العميل كمستهدف نهائي

| البند | التفاصيل |
|-------|----------|
| **الخطوة** | تسجيل الدخول كـ **مهندس** أو **أدمن**. |
| **الرابط** | `/login` ثم التوجيه التلقائي. |
| **المتوقّع** | المهندس يُوجّه إلى `/engineer/dashboard`، والأدمن إلى `/admin/dashboard`. لا يبقى أي منهما في لوحة العميل (`/dashboard`) كمستهدف نهائي بعد تسجيل الدخول. |
| **ملاحظة** | مع Supabase قد يحدث توجيه أولي إلى `/dashboard` ثم تصحيح المسار من الصفحة — مقبول. |
| **حالة التنفيذ** | ☐ |

---

## 6. تسجيل الخروج

| البند | التفاصيل |
|-------|----------|
| **الخطوة** | من أي صفحة (مستخدم مسجّل) اختيار **تسجيل الخروج** من قائمة المستخدم في الهيدر. |
| **المتوقّع** | التوجيه إلى `/login`، اختفاء قائمة المستخدم ولوحة التحكم، وتنظيف الجلسة (إعادة فتح `/dashboard` لا يجب أن تسمح بالوصول بدون تسجيل دخول مجدداً). |
| **حالة التنفيذ** | ☐ |

---

## 7. مستخدم مسجّل يفتح /login أو /register

| البند | التفاصيل |
|-------|----------|
| **الخطوة** | بعد تسجيل الدخول، فتح `/login` أو `/register` مباشرة (من شريط العناوين أو رابط). |
| **الرابط** | `/login` أو `/register` |
| **المتوقّع** | توجيه للوحة المناسبة (عميل → `/dashboard`، مهندس → `/engineer/dashboard`، أدمن → `/admin/dashboard`). مع Supabase قد يُوجّه أولاً إلى `/dashboard` ثم تُصحح الصفحة المسار للمهندس/الأدمن. |
| **حالة التنفيذ** | ☐ |

---

## ملخص

- تنفيذ البنود 1–7 يغطي قائمة التحقق في القسم 8 من [AUTH-WORKFLOW.md](AUTH-WORKFLOW.md).
- يُفضّل التنفيذ مع **NextAuth** ومرة مع **Supabase** (تبديل `NEXT_PUBLIC_USE_SUPABASE_AUTH`) إن أمكن.
- عند وجود مشاكل، الرجوع إلى [AUTH-WORKFLOW.md](AUTH-WORKFLOW.md) و [AUTH.md](AUTH.md).

**آخر تحديث:** 4 فبراير 2026
