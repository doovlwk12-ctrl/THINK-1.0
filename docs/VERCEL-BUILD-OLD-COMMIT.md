# خطة حل مشكلة بناء Vercel من commit قديم (2784dcc)

## المشكلة

سجل البناء على Vercel يظهر:
- `Cloning github.com/doovlwk12-ctrl/THINK-1.0 (Branch: main, Commit: 2784dcc)`

بينما الفرع `main` على GitHub يحتوي على commits أحدث (مثل `7219300`، `041a6b4`) التي تتضمن إصلاحات TypeScript وESLint. النتيجة: البناء يستخدم كوداً قديماً ويظهر تحذيرات أو أخطاء تم حلها محلياً.

## السبب المحتمل

1. **استخدام "Redeploy" على نشر قديم:** زر "Redeploy" يعيد بناء **نفس الـ commit** المرتبط بذلك النشر. لا يجلب أحدث كود من `main`.
2. **النشر الذي تشاهده قديم:** قد يكون آخر نشر ناجح في القائمة من وقت سابق.
3. **إعداد Git في Vercel:** الفرع المعيّن للإنتاج أو المستودع قد يكون مختلفاً.

## خطة الحل

### الخطوة 1: التأكد من أن GitHub يحتوي أحدث الكود

على جهازك (من مجلد المشروع):

```bash
git fetch origin
git log origin/main --oneline -5
```

يجب أن ترى على الأقل: `7219300`, `b118a93`, `041a6b4`, `3ca0727`. إن لم تظهر، نفّذ:

```bash
git push origin main
```

ثم تحقق من صفحة المستودع على GitHub (تبويب Commits) أن آخر commit على `main` هو الأحدث.

### الخطوة 2: التحقق من إعدادات Git في Vercel

1. ادخل إلى [vercel.com](https://vercel.com) → مشروعك (THINK-1.0).
2. **Settings** → **Git**:
   - **Production Branch:** يجب أن يكون `main`.
   - **Connected Git Repository:** يجب أن يكون `doovlwk12-ctrl/THINK-1.0` (أو المسار الصحيح لمستودعك).
3. إن كان المستودع أو الفرع مختلفاً، صحّحه واحفظ.

### الخطوة 3: تشغيل نشر جديد من أحدث commit (وليس Redeploy قديم)

- **الطريقة الموصى بها:** دفع commit جديد إلى `main` ليُطلق نشراً تلقائياً:
  - من المشروع محلياً يمكن تنفيذ:  
    `git commit --allow-empty -m "chore: trigger Vercel deploy from latest main"`  
    ثم `git push origin main`.
  - بعد الدفع، انتقل إلى Vercel → **Deployments** وانتظر حتى يظهر **نشر جديد** (الأعلى في القائمة). تأكد أن الـ commit المرتبط به هو الأحدث (مثل `7219300` أو الـ commit الفارغ الذي دفعته).
- **ما يجب تجنبه:** عدم النقر على "Redeploy" لنشر قديم إذا كان الهدف هو بناء أحدث كود؛ "Redeploy" يبني نفس الـ commit القديم.

### الخطوة 4: التأكد من أن البناء من آخر commit

بعد اكتمال النشر الجديد:

1. افتح آخر **Deployment** في القائمة (الأعلى).
2. في تفاصيل النشر، تحقق من **Commit** أو **Source** — يجب أن يكون الـ hash هو أحدث commit على `main` (مثل `7219300` أو الذي بعده).
3. راجع **Build Logs** لهذا النشر؛ يجب أن يظهر `Cloning ... Commit: <أحدث_hash>` وليس `2784dcc`.

إذا ظهر الـ commit الصحيح واكتمل البناء بنجاح، تكون المشكلة محلولة.

### الخطوة 5 (اختياري): إن لم يُطلق نشر تلقائي عند الدفع

- من **Vercel → Deployments** تحقق من وجود نشر أحدث من وقت دفعك. إن لم يظهر أي نشر جديد:
  - راجع **Settings → Git** وتأكد أن "Deploy Hooks" أو الربط مع GitHub مفعّل.
  - من GitHub تحقق من **Settings → Webhooks** للمستودع أن هناك webhook لـ Vercel وأن الطلبات الأخيرة ناجحة.
- يمكن أيضاً من واجهة Vercel استخدام "Deploy" أو "Redeploy" إن وُجد خيار لاختيار الفرع أو آخر commit (حسب إصدار Vercel).

## ملخص

| الإجراء | الهدف |
|--------|--------|
| التأكد من `origin/main` محدّث | أن يكون أحدث كود على GitHub |
| التحقق من Git في Vercel (فرع + مستودع) | أن النشر يُبنى من المستودع والفرع الصحيحين |
| دفع commit جديد وانتظار نشر تلقائي | إطلاق بناء من أحدث commit |
| عدم استخدام Redeploy لنشر قديم عند الرغبة بأحدث كود | تجنب إعادة بناء 2784dcc |
| التحقق من آخر Deployment وCommit فيه | التأكد أن Vercel يبني من أحدث commit |

بعد تطبيق هذه الخطوات، البناء على Vercel يجب أن يعكس آخر التعديلات (إصلاح reset-password وإصلاحات ESLint) ويُكمل بنجاح إن كانت متغيرات البيئة مضبوطة.
